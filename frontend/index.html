<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FS Chatbot</title>
<style>
/* Alle Styles wie vorher, inkl. pinke Bubble, Chatfenster, Tipp-Animation */
body { margin:0; font-family: Arial, sans-serif; }
#chat-bubble { position: fixed; bottom: 20px; right: 20px; width:60px; height:60px; border-radius:50%; background:hotpink; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; font-size:18px; cursor:pointer; z-index:1000; box-shadow:0 4px 10px rgba(0,0,0,0.2);}
#chat-window { position: fixed; bottom:90px; right:20px; width:320px; height:420px; background:#fff; border:1px solid #ccc; border-radius:10px; display:none; flex-direction:column; box-shadow:0 4px 20px rgba(0,0,0,0.2); overflow:hidden; z-index:1000;}
#chat-header { background:hotpink; color:white; padding:10px; font-weight:bold; text-align:center;}
#messages { flex:1; padding:10px; overflow-y:auto; font-size:14px; background:#fafafa;}
.msg { margin:5px 0; padding:8px 12px; border-radius:15px; max-width:75%; word-wrap:break-word;}
.user { background:hotpink; color:white; margin-left:auto; }
.bot { background:#eee; color:#333; margin-right:auto; }
#input-area { display:flex; border-top:1px solid #ccc;}
#userInput { flex:1; padding:10px; border:none; outline:none; font-size:14px;}
#sendBtn { background:hotpink; border:none; color:white; padding:0 15px; cursor:pointer; font-size:16px;}
.typing { display:inline-block; }
.typing span { display:inline-block; width:6px; height:6px; margin:0 2px; background:#555; border-radius:50%; animation:blink 1.4s infinite both;}
.typing span:nth-child(2) { animation-delay:0.2s; }
.typing span:nth-child(3) { animation-delay:0.4s; }
@keyframes blink {0% {opacity:.2;} 20% {opacity:1;} 100% {opacity:.2;}}
</style>
</head>
<body>
<div id="chat-bubble">FS</div>
<div id="chat-window">
  <div id="chat-header">FS Chatbot</div>
  <div id="messages"></div>
  <div id="input-area">
    <input id="userInput" type="text" placeholder="Schreibe eine Nachrichtâ€¦" />
    <button id="sendBtn">âž¤</button>
  </div>
</div>

<script>
const bubble = document.getElementById("chat-bubble");
const win = document.getElementById("chat-window");
const messages = document.getElementById("messages");
const input = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");

// BegrÃ¼ÃŸung
function showWelcomeMessage(){ addMsg("bot", "Hallo ðŸ‘‹! Ich bin dein FS-Chatbot. Stell mir gerne eine Frage."); }

bubble.addEventListener("click", ()=>{
  const isOpen = win.style.display==="flex";
  win.style.display = isOpen ? "none":"flex";
  if(!isOpen) showWelcomeMessage();
});

function addMsg(who,text,id=null){
  const d=document.createElement("div");
  d.className = "msg "+(who==="user"?"user":"bot");
  if(id==="typing-indicator") d.innerHTML='<div class="typing"><span></span><span></span><span></span></div>';
  else d.textContent=text;
  if(id) d.id=id;
  messages.appendChild(d);
  messages.scrollTop=messages.scrollHeight;
}
function removeMsg(id){ const el=document.getElementById(id); if(el) el.remove(); }

async function sendMessage(){
  const text=input.value.trim(); if(!text) return;
  addMsg("user",text); input.value="";
  const typingId="typing-indicator"; addMsg("bot","",typingId);

  try{
    // Zuerst FAQ
    const faqRes = await fetch(window.location.origin+"/faq", { method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({message:text}) });
    const faqData = await faqRes.json();
    if(faqData.answer){ removeMsg(typingId); addMsg("bot", faqData.answer); }
    else{ // fallback KI
      const aiRes = await fetch(window.location.origin+"/chat", { method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({message:text}) });
      const aiData = await aiRes.json();
      removeMsg(typingId); addMsg("bot", aiData.answer || "(keine Antwort)");
    }
  }catch(e){ removeMsg(typingId); addMsg("bot","Fehler: Server nicht erreichbar."); console.error(e);}
}

sendBtn.addEventListener("click",sendMessage);
input.addEventListener("keydown",(e)=>{if(e.key==="Enter") sendMessage();});
</script>
</body>
</html>
